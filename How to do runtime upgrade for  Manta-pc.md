# How to do runtime upgrade for  Manta-pc

1. Compile manta-pc project.

```shell
git clone https://github.com/paritytech/polkadot.git
cd polkadot
git checkout release-v0.9.3
cargo build --release
```

2. Start two relaychain and one parachain. You can follow the steps on [Manta/docs at manta-pc · Manta-Network/Manta (github.com)](https://github.com/Manta-Network/Manta/tree/manta-pc/docs)

3. Go to manta runtime crate, search the field `spec_version`(100), and increase it by 1. Just like this,

```rust
...
spec_version: 1,
...
```

4. Now, compile the whole project again. It should go smoothly. When it’s done, find the file `target/release/wbuild/manta-pc-runtime/manta_pc_runtime.compact.wasm`.
5. It’s time to do runtime upgrade.

- Checkout current spec version, it’s `2`.

  ![image-20210625195047428](/Users/xiaqiudong/Library/Application Support/typora-user-images/image-20210625195047428.png)

- Let’s do it. Follow the figure to fill dialog. And this call will be dispatched after 10 blocks. Definitely you can input any number in the after filed.

![image-20210625202502186](/Users/xiaqiudong/Library/Application Support/typora-user-images/image-20210625202502186.png)

  Tips: It would be better if you open the console of browser, some info will be pop up, and going to tell you what changes in this new runtime.

- After 10 blocks, you should see the spec version become `3` at the left above conner.

Record 

In explorer console:

```javascript
sending 0xd26e5c008400d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d013a19408ec256ed8042a3ae64ee66e3680ff634a4df682f25244f6a0c495ad678f43e89bdb4f3a44f7d0bb3d4e0c20c21bc62ef0385c47b6d1fb3dc14abea2c8f150200002b0005040a00000000000003f66c5c000061736d010000000186033660037f7f7f017f60027f7f017f60017f0060047f7f7f7f0060037f7f7f0060027f7f0060017f017f60057f7f7f7f7f0060047f7f7f7f017f60067f7f7f7f7f7f0060000060017f017e60017e0060017e017e6000017f60037f7e7f017f60027f7f017e60027f7e017f60027e7e0060027e7e017f60027e7e017e60047e7e7e7f017e60037e7e7e0060017e017f60037e7e7f017e6000017e60037f7e7e0060027e7f017f60057f7f7f7f7f017f60037e7f7f0060087f7f7f7f7f7f7f7f0060067f7f7f7e7e7f0060037e7f7f017f60077f7f7e7e7e7f7f0060067f7f7e7e7f7f0060027e7f017e60077f7e7e7e7e7e7e0060047f7f7e7e0060037f7f7f017e60047f7e7f7f0060057f7f7f7e7e0060077f7f7f7e7e7f7f0060087f7f7f7f7e7e7f7f0060027f7e0060037f7f7e0060057f7f7e7f7f0060097f7f7f7f7f7f7f7f7e0060067f7f7f7f7e7e0060097f7f7f7f7f7f7f7f7f00600a7f7f7f7f7f7f7f7f7f7f0060087f7f7f7f7f7e7e7f0060037f7e7e017f60047f7e7e7f0060057f7e7e7e7e0002eb0d2b03656e76066d656d6f727902001203656e761d6578745f6d6973635f7072696e745f757466385f76657273696f6e5f31000c03656e761c6578745f6d6973635f7072696e745f6865785f76657273696f6e5f31000c03656e76226578745f6d6973635f72756e74696d655f76657273696f6e5f76657273696f6e5f31000d03656e761f6578745f6c6f6767696e675f6d61785f6c6576656c5f76657273696f6e5f31000e03656e76236578745f63727970746f5f656432353531395f7665726966795f76657273696f6e5f31000f03656e76286578745f63727970746f5f66696e6973685f62617463685f7665726966795f76657273696f6e5f31000e03656e76376578745f63727970746f5f736563703235366b315f65636473615f7265636f7665725f636f6d707265737365645f76657273696f6e5f31001003656e76256578745f63727970746f5f737232353531395f67656e65726174655f76657273696f6e5f31001103656e76236578745f63727970746f5f737232353531395f7665726966795f76657273696f6e5f32000f03656e76276578745f63727970746f5f73746172745f62617463685f7665726966795f76657273696f6e5f31000a03656e761c6578745f616c6c6f6361746f725f667265655f76657273696f6e5f31000203656e761e6578745f616c6c6f6361746f725f6d616c6c6f635f76657273696f6e5f31000603656e76296578745f64656661756c745f6368696c645f73746f726167655f636c6561725f76657273696f6e5f31001203656e76306578745f64656661756c745f6368696c645f73746f726167655f636c6561725f7072656669785f76657273696f6e5f31001203656e762a6578745f64656661756c745f6368696c645f73746f726167655f6578697374735f76657273696f6e5f31001303656e76276578745f64656661756c745f6368696c645f73746f726167655f6765745f76657273696f6e5f31001403656e762c6578745f64656661756c745f6368696c645f73746f726167655f6e6578745f6b65795f76657273696f6e5f31001403656e76286578745f64656661756c745f6368696c645f73746f726167655f726561645f76657273696f6e5f31001503656e76286578745f64656661756c745f6368696c645f73746f726167655f726f6f745f76657273696f6e5f31000d03656e76276578745f64656661756c745f6368696c645f73746f726167655f7365745f76657273696f6e5f31001603656e76306578745f64656661756c745f6368696c645f73746f726167655f73746f726167655f6b696c6c5f76657273696f6e5f33001403656e76206578745f68617368696e675f626c616b65325f3132385f76657273696f6e5f31001703656e76206578745f68617368696e675f626c616b65325f3235365f76657273696f6e5f31001703656e761e6578745f68617368696e675f74776f785f3132385f76657273696f6e5f31001703656e761d6578745f68617368696e675f74776f785f36345f76657273696f6e5f31001703656e762a6578745f747269655f626c616b65325f3235365f6f7264657265645f726f6f745f76657273696f6e5f31001703656e761c6578745f73746f726167655f617070656e645f76657273696f6e5f31001203656e76226578745f73746f726167655f6368616e6765735f726f6f745f76657273696f6e5f31000d03656e761b6578745f73746f726167655f636c6561725f76657273696f6e5f31000c03656e76226578745f73746f726167655f636c6561725f7072656669785f76657273696f6e5f31000c03656e76286578745f73746f726167655f636f6d6d69745f7472616e73616374696f6e5f76657273696f6e5f31000a03656e761c6578745f73746f726167655f6578697374735f76657273696f6e5f31001703656e76196578745f73746f726167655f6765745f76657273696f6e5f31000d03656e761e6578745f73746f726167655f6e6578745f6b65795f76657273696f6e5f31000d03656e761a6578745f73746f726167655f726561645f76657273696f6e5f31001803656e762a6578745f73746f726167655f726f6c6c6261636b5f7472616e73616374696f6e5f76657273696f6e5f31000a03656e761a6578745f73746f726167655f726f6f745f76657273696f6e5f31001903656e76196578745f73746f726167655f7365745f76657273696f6e5f31001203656e76276578745f73746f726167655f73746172745f7472616e73616374696f6e5f76657273696f6e5f31000a03656e76196578745f6c6f6767696e675f6c6f675f76657273696f6e5f31001a03656e76226578745f6f6666636861696e5f696e6465785f636c6561725f76657273696f6e5f31000c03656e76206578745f6f6666636861696e5f696e6465785f7365745f76657273696f6e5f31001203f107ef070a0a0a0a0a04040406020500040700010105010505011b02020b1c0804000701010106060104040901010101040101001c010100010100001d0004010101050305030003040504040501070705020101040503090304010502050404040a0a0a071e0903070803040703050405040404040404050105030501050105020405050204050502040504050502050205050405020405050504050502040505050204040504040404050405040404040410040b050505050505040305050501010104021f0504
main.9e59b4e0.js:19 signAndSend: status :: {"events":[],"status":{"ready":null}}
main.9e59b4e0.js:19 signAndSend: status :: {"dispatchInfo":{"weight":163889000,"class":"Normal","paysFee":"Yes"},"events":[{"phase":{"applyExtrinsic":2},"event":{"index":"0x0500","data":[47,0]},"topics":[]},{"phase":{"applyExtrinsic":2},"event":{"index":"0x2b00","data":[{"ok":[]}]},"topics":[]},{"phase":{"applyExtrinsic":2},"event":{"index":"0x0000","data":[{"weight":163889000,"class":"Normal","paysFee":"Yes"}]},"topics":[]}],"status":{"inBlock":"0x22153c5e6729de68f604d82e04eb208708c9f09a592895f7f774d20fd3cb8dbb"}}
```

Parachain:

Event:

![image-20210625205332631](/Users/xiaqiudong/Library/Application Support/typora-user-images/image-20210625205332631.png)

Success

![image-20210625205353477](/Users/xiaqiudong/Library/Application Support/typora-user-images/image-20210625205353477.png)

Relychain:

In block 132

`data: ParachainsInherentData`

```javascript
{
  bitfields: [
    {
      payload: 0b00000000,
      validatorIndex: 0,
      signature: 0xa61ec5417298e06be002959db65645b5b5851d1276104e14e95bf9be9549ef32bb9a7667aec0a4d3bc20c6751fa4226ad28698b8695c0ad08b72be11c4af858a
    },
    {
      payload: 0b00000000,
      validatorIndex: 1,
      signature: 0x70f6926d44b46b3e10c091f0d19f634d4e0ac1bbb0afc8037c38655fb4ee62260d0ee84d8a405de91dba255d7debbc656090ccf6f03d5b9a0d2e7531568dfe8f
    }
  ],
  backedCandidates: [
    {
      candidate: {
        descriptor: {
          paraId: 6,666,
          relayParent: 0x26ed4213c2d4f0013c3598ec93d0940bf94d473c3e954713007036c44d7d15c8,
          collatorId: 0x28bdef278d2eefa59cc6cd28907de327048caf682cbfd3ad618c04bd1ed2fa07,
          persistedValidationDataHash: 0x075344f419a8c9fc3c02859f8c754d990052b2eb929f81541526b2a5fb9f58bb,
          povHash: 0xf43552f77008b1c77b6954c44dd4c5cd7ff355f2bbaf76c5ba31d1317018ba5a,
          erasureRoot: 0x46fbd195eaa0c007700a2955a01db7789974f8b58b47a001ac90229568918772,
          signature: 0x0a497fc63f5d289de38c2ae5f6b116b6376879bf809095b6201fc76d59902122edccd010066254f95dda1b5142e1edff9ec8a40ab580279f6fad1714ec8fe285,
          paraHead: 0x3d7502feb984c1dfaa31b5da307a65d9b5f51ad5011495f1cb2b2f76bef12cb5,
          validationCodeHash: 0x08cac1b4fb0f7194e2373221caf34f6e61237d67dd55e20ebc55c85474730596
        },
        commitments: {
          upwardMessages: [],
          horizontalMessages: [],
          newValidationCode: null,
          headData: 0x10a0db360fb945f5aae92e4cf6f083d85dab32352989a731b396a12808b0962ab873ad035db8c4ed4d581800d955ef7a336896aa16f53c31b395ecc92c5a341d5fb77c11c3db063b63b091a3dca3dcba0f2cf9793ceea534c0ab7e4305d357542508066175726120e6a22310000000000561757261010160d6f0fe83b3b2004860b2385759eb4f2296058024f3e4df8893124a4bd3423cd432dba093c0c0200fcae2400f061743322f6ce7a69fe4dd627101a260335e8f,
          processedDownwardMessages: 0,
          hrmpWatermark: 131
        }
      },
      validityVotes: [
        {
          Implicit: 0x0afd0e401c1437a1de16c6e8d71ca9fdc512c418f9ca1a1331904545aeba714690c9584660c2cc6bc6ed73e667c9b1938a1737dd7cdae1a5137fb2c37b998785
        },
        {
          Explicit: 0x9e85d953677adb18eda7f459fe0a79a078a75dc0d825305ab049ea1177437d67fc143204e9d05c1b02ed77bbdf00fb3db7481c2b2e4d345530d2d5e701aca784
        }
      ],
      validatorIndices: 0b00000011
    }
  ],
  disputes: [],
  parentHeader: {
    parentHash: 0xb65cd42482d6c75bd18d08bf616bcd988f2f38b98a601739d253d6a929a6f527,
    number: 131,
    stateRoot: 0x738f30a0aece843a8a662bd07590860d74ab003ea87300ddbe91e158fb5f001b,
    extrinsicsRoot: 0x3d04e1d08070b9c6c46dd154b43bdfca9f8011a0b34b2d3be2d5dd9dcfc4f898,
    digest: {
      logs: [
        {
          PreRuntime: [
            BABE,
            0x0100000000e6a22310000000005e778e48f1c2dc2b29bfbe4c2a465d78acf12de43befdfae672fab148bacfe6cb7a66dea56dd886734a71ecf59b2ce7c5b8da5854477f446b8089d517f09b706ee88d53788345ed7b9fd3cd5b419af1e5330dabb121d2195f9f73d18c73dd60c
          ]
        },
        {
          Consensus: [
            BEEF,
            0x0369200d7760cf8fc365823ca7c992daf3d34ffbb542018358a501b1d2edef1857
          ]
        },
        {
          Consensus: [
            BABE,
            0x0108d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d01000000000000008eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a480100000000000000afadfa01c82f474bb477c8eea5a405a8dcc31dd76afb85e6fbb4ddaeea569ba7
          ]
        },
        {
          Consensus: [
            FRNK,
            0x010888dc3417d5058ec4b4503e0c12ea1a0a89be200fe98922423d4334014fa6b0ee0100000000000000d17c2d7823ebf260fd138f2d7e27d114c0145d968b5ff5006125f2414fadae69010000000000000000000000
          ]
        },
        {
          Seal: [
            BABE,
            0x2eeb154f36ae11b40d0c9935115699ab2d45c3374c11cced142c934365a65828d22ac9d01ceb8287dc22cfd9196e07d75fc61a5f4714967cb2d92e43ce6cba89
          ]
        }
      ]
    }
  }
}
```



In block 133

![image-20210625205422992](/Users/xiaqiudong/Library/Application Support/typora-user-images/image-20210625205422992.png)

